package net.minecraft.client.render.entity;

import com.google.common.collect.Maps;
import java.util.Map;
import net.fabricmc.api.EnvType;
import net.fabricmc.api.Environment;
import net.minecraft.client.render.entity.feature.PandaHeldItemFeatureRenderer;
import net.minecraft.client.render.entity.model.EntityModelLayers;
import net.minecraft.client.render.entity.model.PandaEntityModel;
import net.minecraft.client.render.entity.state.EntityRenderState;
import net.minecraft.client.render.entity.state.ItemHolderEntityRenderState;
import net.minecraft.client.render.entity.state.LivingEntityRenderState;
import net.minecraft.client.render.entity.state.PandaEntityRenderState;
import net.minecraft.client.util.math.MatrixStack;
import net.minecraft.entity.passive.PandaEntity;
import net.minecraft.util.Identifier;
import net.minecraft.util.math.MathHelper;
import net.minecraft.util.math.RotationAxis;

@Environment(EnvType.CLIENT)
public class PandaEntityRenderer extends AgeableMobEntityRenderer {
   private static final Map TEXTURES;

   public PandaEntityRenderer(EntityRendererFactory.Context context) {
      super(context, new PandaEntityModel(context.getPart(EntityModelLayers.PANDA)), new PandaEntityModel(context.getPart(EntityModelLayers.PANDA_BABY)), 0.9F);
      this.addFeature(new PandaHeldItemFeatureRenderer(this));
   }

   public Identifier getTexture(PandaEntityRenderState pandaEntityRenderState) {
      return (Identifier)TEXTURES.getOrDefault(pandaEntityRenderState.gene, (Identifier)TEXTURES.get(PandaEntity.Gene.NORMAL));
   }

   public PandaEntityRenderState createRenderState() {
      return new PandaEntityRenderState();
   }

   public void updateRenderState(PandaEntity pandaEntity, PandaEntityRenderState pandaEntityRenderState, float f) {
      super.updateRenderState(pandaEntity, pandaEntityRenderState, f);
      ItemHolderEntityRenderState.update(pandaEntity, pandaEntityRenderState, this.itemModelResolver);
      pandaEntityRenderState.gene = pandaEntity.getProductGene();
      pandaEntityRenderState.askingForBamboo = pandaEntity.getAskForBambooTicks() > 0;
      pandaEntityRenderState.sneezing = pandaEntity.isSneezing();
      pandaEntityRenderState.sneezeProgress = pandaEntity.getSneezeProgress();
      pandaEntityRenderState.eating = pandaEntity.isEating();
      pandaEntityRenderState.scaredByThunderstorm = pandaEntity.isScaredByThunderstorm();
      pandaEntityRenderState.sitting = pandaEntity.isSitting();
      pandaEntityRenderState.sittingAnimationProgress = pandaEntity.getSittingAnimationProgress(f);
      pandaEntityRenderState.lieOnBackAnimationProgress = pandaEntity.getLieOnBackAnimationProgress(f);
      pandaEntityRenderState.rollOverAnimationProgress = pandaEntity.isBaby() ? 0.0F : pandaEntity.getRollOverAnimationProgress(f);
      pandaEntityRenderState.playingTicks = pandaEntity.playingTicks > 0 ? (float)pandaEntity.playingTicks + f : 0.0F;
   }

   protected void setupTransforms(PandaEntityRenderState pandaEntityRenderState, MatrixStack matrixStack, float f, float g) {
      super.setupTransforms(pandaEntityRenderState, matrixStack, f, g);
      float h;
      if (pandaEntityRenderState.playingTicks > 0.0F) {
         h = MathHelper.fractionalPart(pandaEntityRenderState.playingTicks);
         int i = MathHelper.floor(pandaEntityRenderState.playingTicks);
         int j = i + 1;
         float k = 7.0F;
         float l = pandaEntityRenderState.baby ? 0.3F : 0.8F;
         float o;
         float m;
         float n;
         if ((float)i < 8.0F) {
            m = 90.0F * (float)i / 7.0F;
            n = 90.0F * (float)j / 7.0F;
            o = this.getAngle(m, n, j, h, 8.0F);
            matrixStack.translate(0.0F, (l + 0.2F) * (o / 90.0F), 0.0F);
            matrixStack.multiply(RotationAxis.POSITIVE_X.rotationDegrees(-o));
         } else {
            float p;
            if ((float)i < 16.0F) {
               m = ((float)i - 8.0F) / 7.0F;
               n = 90.0F + 90.0F * m;
               p = 90.0F + 90.0F * ((float)j - 8.0F) / 7.0F;
               o = this.getAngle(n, p, j, h, 16.0F);
               matrixStack.translate(0.0F, l + 0.2F + (l - 0.2F) * (o - 90.0F) / 90.0F, 0.0F);
               matrixStack.multiply(RotationAxis.POSITIVE_X.rotationDegrees(-o));
            } else if ((float)i < 24.0F) {
               m = ((float)i - 16.0F) / 7.0F;
               n = 180.0F + 90.0F * m;
               p = 180.0F + 90.0F * ((float)j - 16.0F) / 7.0F;
               o = this.getAngle(n, p, j, h, 24.0F);
               matrixStack.translate(0.0F, l + l * (270.0F - o) / 90.0F, 0.0F);
               matrixStack.multiply(RotationAxis.POSITIVE_X.rotationDegrees(-o));
            } else if (i < 32) {
               m = ((float)i - 24.0F) / 7.0F;
               n = 270.0F + 90.0F * m;
               p = 270.0F + 90.0F * ((float)j - 24.0F) / 7.0F;
               o = this.getAngle(n, p, j, h, 32.0F);
               matrixStack.translate(0.0F, l * ((360.0F - o) / 90.0F), 0.0F);
               matrixStack.multiply(RotationAxis.POSITIVE_X.rotationDegrees(-o));
            }
         }
      }

      h = pandaEntityRenderState.sittingAnimationProgress;
      float q;
      if (h > 0.0F) {
         matrixStack.translate(0.0F, 0.8F * h, 0.0F);
         matrixStack.multiply(RotationAxis.POSITIVE_X.rotationDegrees(MathHelper.lerp(h, pandaEntityRenderState.pitch, pandaEntityRenderState.pitch + 90.0F)));
         matrixStack.translate(0.0F, -1.0F * h, 0.0F);
         if (pandaEntityRenderState.scaredByThunderstorm) {
            q = (float)(Math.cos((double)(pandaEntityRenderState.age * 1.25F)) * Math.PI * 0.05000000074505806);
            matrixStack.multiply(RotationAxis.POSITIVE_Y.rotationDegrees(q));
            if (pandaEntityRenderState.baby) {
               matrixStack.translate(0.0F, 0.8F, 0.55F);
            }
         }
      }

      q = pandaEntityRenderState.lieOnBackAnimationProgress;
      if (q > 0.0F) {
         float r = pandaEntityRenderState.baby ? 0.5F : 1.3F;
         matrixStack.translate(0.0F, r * q, 0.0F);
         matrixStack.multiply(RotationAxis.POSITIVE_X.rotationDegrees(MathHelper.lerp(q, pandaEntityRenderState.pitch, pandaEntityRenderState.pitch + 180.0F)));
      }

   }

   private float getAngle(float f, float g, int i, float h, float j) {
      return (float)i < j ? MathHelper.lerp(h, f, g) : f;
   }

   // $FF: synthetic method
   public Identifier getTexture(final LivingEntityRenderState state) {
      return this.getTexture((PandaEntityRenderState)state);
   }

   // $FF: synthetic method
   public EntityRenderState createRenderState() {
      return this.createRenderState();
   }

   static {
      TEXTURES = Maps.newEnumMap(Map.of(PandaEntity.Gene.NORMAL, Identifier.ofVanilla("textures/entity/panda/panda.png"), PandaEntity.Gene.LAZY, Identifier.ofVanilla("textures/entity/panda/lazy_panda.png"), PandaEntity.Gene.WORRIED, Identifier.ofVanilla("textures/entity/panda/worried_panda.png"), PandaEntity.Gene.PLAYFUL, Identifier.ofVanilla("textures/entity/panda/playful_panda.png"), PandaEntity.Gene.BROWN, Identifier.ofVanilla("textures/entity/panda/brown_panda.png"), PandaEntity.Gene.WEAK, Identifier.ofVanilla("textures/entity/panda/weak_panda.png"), PandaEntity.Gene.AGGRESSIVE, Identifier.ofVanilla("textures/entity/panda/aggressive_panda.png")));
   }
}
